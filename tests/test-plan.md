# テストプラン: e2e-testing-demo-20251105

## エグゼクティブサマリ
このドキュメントはローカル React デモアプリ（`app/`）の E2E テストプランです。主要画面はログイン画面とダッシュボード（`Login.tsx`, `Dashboard.tsx`）で、既に Playwright を使ったサンプルテスト（`tests/login.spec.ts`）があります。本プランはQAチームや開発チームが再現可能に実行できる詳細なシナリオを提供します。

目的:
- 正常系（ハッピーパス）を網羅
- 入力検証・エラーハンドリング・境界ケースを検証
- UI/アクセシビリティ・ナビゲーションに関する検証
- 将来の機能追加（認可、セッション管理）のための回帰テスト群の基盤を提供

対象アプリケーション概要
- ルート: `http://localhost:5173/`（Vite 標準ポート）
- 主な画面:
  - ログイン画面（`/`）: ユーザー名・パスワード入力、デモ資格情報の表示、エラーメッセージ
  - ダッシュボード（`/dashboard`）: ログイン後の簡易表示（"ログインしました。"）
- 既存の挙動（現状）: 資格情報 `admin` / `pass` でログインすると `/dashboard` に遷移する。アプリ内に明示的なサーバ側認証や保護されたルートのガードは実装されていない（現在の実装はクライアント遷移のみ）。

想定ユーザータイプ
- 未認証ユーザー（Guest）: ログイン画面に到達し、ログインを試みる
- 認証ユーザー（Authenticated）: 正しい資格情報を持ちダッシュボードにアクセスする
- テスター/自動化: Playwright 等で UI を操作する自動テスト

共通前提（各シナリオ共通）
- テストは「新規/クリーンなブラウザセッション」で開始する（ローカルストレージや cookie は初期化されている）
- サーバは起動済み（`npm start` 等で Vite がポート 5173 でリッスンしている）
- テストは `http://localhost:5173/` を基点に実行する

品質指標（合格基準）
- ハッピーパス: 期待どおりの画面遷移とテキストが表示される
- エラーパス: 不正入力で適切なエラー要素（role=alert 等）が表示される
- UI 要素: 必要なラベル/aria が存在し自動化で安定的に参照可能

---

## 優先度付きテストシナリオ一覧（各シナリオは独立して実行可能）

### シナリオ 1 — ログイン: 正常系（ハッピーパス）
前提: ブラウザはクリーン状態。アプリが `http://localhost:5173/` で起動している。

手順:
1. ルート URL に移動する（`/`）
2. ユーザー名入力欄（aria-label="username"）に `admin` を入力する
3. パスワード入力欄（aria-label="password"）に `pass` を入力する
4. 「ログイン」ボタンをクリックまたはフォームを送信する

期待結果:
- `/dashboard` の表示に遷移し、カード内に `ログインしました。` が見える
- 画面にエラー要素は表示されない

成功判定:
- 上記テキストが表示されたら合格

失敗条件:
- 期待テキストが表示されない、またはページ遷移しない

---

### シナリオ 2 — ログイン: 不正な資格情報（負荷テストではない）
前提: クリーンなブラウザセッション。

手順:
1. ルートに移動
2. `username` に `wrong` を入力
3. `password` に `wrong` を入力
4. ログインを実行

期待結果:
- 画面にエラーメッセージ（`認証に失敗しました`）が role=alert 要素として表示される
- ダッシュボードには遷移しない

成功判定:
- エラーメッセージが可視であり、ページが遷移していない

失敗条件:
- エラーが表示されない、または誤ってダッシュボードに遷移する

---

### シナリオ 3 — 入力検証: 空フィールド送信
前提: クリーンなブラウザセッション。

手順:
1. ルートに移動
2. ユーザー名を空欄、パスワードを空欄にしたままログインを実行

期待結果（現状の実装に基づく）:
- サンプル実装では空入力時の明示的なフロント検証は無いため、エラーは `認証に失敗しました` が表示される想定

成功判定:
- エラーメッセージが表示される

失敗条件:
- 空入力でダッシュボードに遷移する場合は重大（バグ）

---

### シナリオ 4 — 直接 URL アクセス: `/dashboard` へ未認証で直接アクセス
前提: クリーンなブラウザセッション。

手順:
1. 直接 `http://localhost:5173/dashboard` にナビゲートする

期待結果（注記）:
- 現状のクライアント実装ではルートガードが無いため、ダッシュボードが表示される（`ログインしました。` の文言が見える）
- 将来的に保護ルートを実装する場合は、未認証時はログイン画面にリダイレクトされるべき

成功判定:
- 現状の仕様を確認し、実装と仕様が一致しているかを評価

失敗条件:
- 仕様として未認証アクセス禁止が望まれるのにアクセス可能ならば改善提案が必要

---

### シナリオ 5 — セッション/リロードの挙動
目的: ページのリロード時にユーザー状態がどうなるかを確認
前提: ブラウザでログインしてダッシュボードにいる状態（上のハッピーパスを実行済み）

手順:
1. ダッシュボードでページをリロードする

期待結果（現状の実装）:
- クライアントサイドに永続的なセッション保持がないため、リロード後にルートがそのまま `/dashboard` を表示する可能性がある（ブラウザ履歴に依存）
- 将来的に auth persistence を実装する場合は cookie/localStorage の確認を行う

成功判定:
- リロード後に UI が壊れないこと。アプリの期待仕様に合わせた挙動であること

失敗条件:
- リロードでエラーが出る、或いは予期せぬログアウトが発生する（仕様外）

---

### シナリオ 6 — UI 要素とアクセシビリティ（自動化の安定性確認）
目的: 自動テストで参照するセレクタ（aria-label/role/テキスト）が存在することを確認
前提: ルートページにアクセス

チェック項目（手順的には簡易）:
1. `input[aria-label="username"]` が存在
2. `input[aria-label="password"]` が存在かつ `type="password"` である
3. ログインボタン（テキスト: `ログイン`）が存在
4. デモ資格情報の表示が DOM に存在し、aria-hidden 属性は `true` としている（装飾的要素）

期待結果:
- 上記要素が存在し、テストの安定性に必要な識別子が揃っている

成功判定:
- すべての要素が見つかる

失敗条件:
- 重要な要素に一意の識別子がなく、選択が不安定な場合は改善を提案

---

### シナリオ 7 — レスポンシブ表示（モバイル）
目的: 小さなビューポートでレイアウトが破綻しないことを検証
前提: ブラウザはクリーン。

手順:
1. ビューポートを 375x812（iPhone X 相当）に設定
2. ルートページを開く
3. ログイン要素が可視であることを確認

期待結果:
- フォームがスクロール可能であり、操作可能
- テキストやボタンが画面に収まるか、少なくとも操作可能である

成功判定:
- 主要操作がモバイルで可能

失敗条件:
- レイアウトが崩れてボタンや入力にアクセスできない

---

### シナリオ 8 — ログインページの国際化/表示検証（日本語 UI の確認）
目的: 主要 UI 文言が日本語で表示されていることを確認

手順:
1. ルートにアクセス
2. ヘッダ `ログイン`、デモ資格情報、ボタン `ログイン` の文言が日本語で表示されることを確認

期待結果:
- 表示文言が日本語である

成功判定:
- UI 文言が日本語として適切に表示される

失敗条件:
- 表示が英語や欠落している場合

---

### シナリオ 9 — 回帰スモーク: CI 向けスモークテスト（短時間）
目的: CI 環境での迅速な健全性チェック
前提: Vite が起動済み。

手順:
1. ルートに移動
2. 正しい資格情報でログイン
3. ダッシュボードの主要テキストが見えることを確認

期待結果:
- サイトの主要フローが破綻していないことを短時間で検出

成功判定:
- スモークテストが緑ならば CI 通過

---

## 実行ノートと自動化ヒント
- 自動化には既にある `tests/login.spec.ts` をベースに拡張してください。
- 安定性向上のため、セレクタは可能な限り `getByLabel`, `getByRole`, `getByText`（アクセシビリティ優先）を使う。
- ネットワーク依存がないローカルアプリだが、将来 API 呼び出しが増える場合はネットワークのモック/フィクスチャを導入する。
- テストデータ: `admin` / `pass`（README に記載済み）

## リスクと改善提案
- 現状、クライアント側に保護ルートの仕組みが無い点はセキュリティ要件では改善候補。未認証時に `/dashboard` へ直接アクセスできるかを確認し、要件に合わせてルートガードを追加すること。
- 永続化（セッション/トークン保存）の要件が出る場合、ログイン状態の確認ロジックとテストの前提を整理する必要あり。

## 優先度と推奨実行順（短期プラン）
1. シナリオ 1（ハッピーパス） — 最優先
2. シナリオ 2（不正認証）
3. シナリオ 6（アクセシビリティ／自動化安定性）
4. シナリオ 4（直接アクセス動作確認）
5. シナリオ 5（リロード/セッション）
6. シナリオ 7（レスポンシブ）
7. シナリオ 8（表示検証）
8. シナリオ 9（CI スモーク）

---

## 付録: テスト実行コマンド（参考）
プロジェクトルートで実行します。

```bash
# 全テスト実行
npx playwright test

# 単一ファイル（例: login.spec.ts）の実行
npx playwright test tests/login.spec.ts

# UI モードで操作しながら実行
npx playwright test --ui
```

---

ファイル保存場所: `tests/test-plan.md`

作成日: 2025-11-05
